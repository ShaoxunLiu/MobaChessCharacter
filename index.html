<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è§’è‰²å¡ - ç”Ÿå‘½å€¼è‡ªåŠ¨åŒæ­¥ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* CSS æ ·å¼éƒ¨åˆ† */
        :root {--primary: #4a90e2;--bg: #f0f2f5;--card-bg: #ffffff;--text: #333;--border: #e1e4e8;--accent: #ff6b6b;--gem-color: #9b59b6;}
        body {font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;background-color: var(--bg);color: var(--text);margin: 0;padding: 0;height: 100vh;overflow: hidden;display: flex;justify-content: center;align-items: center;}
        
        /* å…³é”®ä¿®æ”¹ 1: é˜»æ­¢ #app å®¹å™¨äº§ç”ŸåŒå‡»ç¼©æ”¾å’Œé•¿æŒ‰è¡Œä¸º */
        #app {
            width: 100%;
            height: 100%;
            max-width: 500px;
            background: var(--card-bg);
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
        }
        
        /* æ ‡ç­¾é¡µå¯¼èˆªæ ·å¼ (æ–°å¢) */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin: -20px -20px 20px -20px; /* æ‰©å±•åˆ° #app å®¹å™¨è¾¹ç¼˜ */
            padding: 10px 20px 0 20px;
            border-bottom: 2px solid var(--border);
            background-color: var(--card-bg);
            position: sticky; /* ä¿æŒåœ¨é¡¶éƒ¨ */
            top: 0;
            z-index: 10;
        }
        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: var(--text);
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            transition: border-bottom 0.3s, color 0.3s;
        }
        .tab-button.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        /* è§’è‰²å¡åŸå§‹å†…å®¹çš„æ ·å¼ (æ¥è‡ªæ‚¨çš„åŸæ–‡ä»¶) */
        .header {text-align: center;margin-bottom: 15px;}
        .header h1 {font-size: 24px;margin: 0;color: var(--primary);}
        .input-group {margin-bottom: 15px;}
        .input-group label {display: block;font-weight: bold;margin-bottom: 5px;font-size: 14px;}
        .input-group input[type="text"] {width: 100%;padding: 10px;border: 1px solid var(--border);border-radius: 6px;box-sizing: border-box;font-size: 16px;}
        
        /* å±æ€§åŒºåŸŸ */
        .stats-area {border: 1px solid var(--border);border-radius: 8px;padding: 15px;margin-bottom: 20px;}
        .stats-area h2 {font-size: 18px;margin-top: 0;padding-bottom: 5px;border-bottom: 1px solid var(--border);}
        .stat-item {display: flex;justify-content: space-between;align-items: center;margin-bottom: 10px;padding: 5px 0;border-bottom: 1px dotted var(--border);}
        .stat-name {font-weight: bold;width: 80px;}
        .stat-value {display: flex;align-items: center;}
        .stat-value button {width: 30px;height: 30px;font-size: 18px;line-height: 1;border: none;border-radius: 4px;cursor: pointer;background-color: var(--primary);color: white;margin: 0 5px;transition: background-color 0.2s;}
        .stat-value button:disabled {background-color: #ccc;cursor: not-allowed;}
        .stat-value button:active:not(:disabled) {background-color: #3873c9;}
        .stat-points {width: 25px;text-align: center;font-weight: bold;font-size: 16px;}

        /* æ´¾ç”Ÿå±æ€§/HP/å®çŸ³ */
        .derived-hp-gem {display: grid;grid-template-columns: repeat(2, 1fr);gap: 10px;margin-bottom: 20px;}
        .derived-item, .hp-item, .gem-item {border: 1px solid var(--border);border-radius: 6px;padding: 10px;text-align: center;}
        .derived-item strong, .hp-item strong, .gem-item strong {display: block;font-size: 14px;margin-bottom: 5px;color: #666;}
        .derived-value, .hp-value {font-size: 20px;font-weight: bold;color: var(--primary);}
        .gem-value {font-size: 20px;font-weight: bold;color: var(--gem-color);}
        
        /* HP è°ƒæ•´ */
        .hp-adjust {display: flex;justify-content: center;align-items: center;margin-top: 5px;}
        .hp-adjust input {width: 40px;text-align: center;border: 1px solid var(--border);border-radius: 4px;margin: 0 5px;}
        .hp-adjust button {padding: 5px 10px;border: none;border-radius: 4px;cursor: pointer;background-color: var(--accent);color: white;margin: 0 5px;transition: background-color 0.2s;}
        .hp-adjust button.heal {background-color: #2ecc71;}
        .hp-adjust button:active {opacity: 0.8;}
        
        /* ğŸŒŸ ä¿®æ”¹ 2: å½“å‰ç”Ÿå‘½æ•°å€¼æ”¹ä¸ºçº¢è‰² */
        .current-hp-value {color: var(--accent);}

        /* å®çŸ³è°ƒæ•´ */
        .gem-adjust {display: flex;justify-content: center;margin-top: 5px;}
        .gem-adjust button {padding: 5px 10px;border: none;border-radius: 4px;cursor: pointer;background-color: var(--gem-color);color: white;margin: 0 5px;transition: background-color 0.2s;}
        .gem-adjust button:active {opacity: 0.8;}

        /* å¤‡æ³¨åŒºåŸŸ */
        .notes-area textarea {width: 100%;height: 100px;padding: 10px;border: 1px solid var(--border);border-radius: 6px;box-sizing: border-box;font-size: 14px;resize: vertical;}

        /* æŠ€èƒ½æ ‘éƒ¨åˆ† (æ–°å¢) */
        .skill-tree-content {padding-top: 10px;}
        .skill-tree-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .skill-tree-image-container {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border);
            border-radius: 6px;
            background-color: #f9f9f9;
            box-sizing: border-box;
            padding: 10px;
            overflow: auto; /* å…è®¸å›¾ç‰‡æ»šåŠ¨ */
        }
        .skill-tree-image-container img {
            max-width: none;
            width: 100%; 
            min-width: 300px; /* é˜²æ­¢å›¾ç‰‡è¿‡å° */
            display: block;
            touch-action: pan-x pan-y;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="tabs">
        <button class="tab-button" :class="{ active: currentTab === 'charCard' }" @click="currentTab = 'charCard'">
            è§’è‰²å¡
        </button>
        <button class="tab-button" :class="{ active: currentTab === 'skillTree' }" @click="currentTab = 'skillTree'">
            æŠ€èƒ½æ ‘
        </button>
    </div>

    <div v-if="currentTab === 'charCard'" class="char-card-content">
        <div class="header">
            <h1>{{ character.name || 'æ–°è§’è‰²' }}</h1>
            <button @click="resetCharacter" style="margin-top: 10px; padding: 8px 15px; background-color: #ffaa00; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡ç½®è§’è‰²æ•°æ®</button>
        </div>

        <div class="input-group">
            <label for="char-name">è§’è‰²åç§°</label>
            <input id="char-name" type="text" v-model="character.name" placeholder="è¾“å…¥ä½ çš„è§’è‰²åç§°">
        </div>

        <div class="derived-hp-gem">
            <div class="hp-item" style="grid-column: span 2;">
                <strong>ç”Ÿå‘½å€¼ (HP)</strong>
                <div class="hp-value">
                    <span :class="{'current-hp-value': character.currentHp < derived.maxHp}">{{ character.currentHp }}</span> / {{ derived.maxHp }}
                </div>
                <div class="hp-adjust">
                    <button @click="updateCurrentHp(-hpChangeValue)">-</button>
                    <input type="number" v-model.number="hpChangeValue" placeholder="æ•°å€¼">
                    <button class="heal" @click="updateCurrentHp(hpChangeValue)">+</button>
                </div>
            </div>
            
            <div class="derived-item">
                <strong>æ”»å‡»åŠ›</strong>
                <span class="derived-value">{{ derived.attack }}</span>
            </div>
            <div class="derived-item">
                <strong>å°„ç¨‹</strong>
                <span class="derived-value">{{ derived.range }}</span>
            </div>
            <div class="derived-item">
                <strong>ç§»åŠ¨åŠ›</strong>
                <span class="derived-value">{{ derived.movement }}</span>
            </div>
            <div class="derived-item">
                <strong>è¡ŒåŠ¨åŠ›</strong>
                <span class="derived-value">{{ derived.action }}</span>
            </div>
            
            <div class="gem-item" style="grid-column: span 2;">
                <strong>å®çŸ³</strong>
                <span class="gem-value">{{ character.gems }}</span>
                <div class="gem-adjust">
                    <button @click="updateGem(-1)">-1</button>
                    <button @click="updateGem(1)">+1</button>
                </div>
            </div>
        </div>

        <div class="stats-area">
            <h2>åŸºç¡€å±æ€§ (å·²åˆ†é…ç‚¹æ•°: {{ totalPoints }})</h2>
            <div v-for="(config, stat) in statConfigs" :key="stat" class="stat-item">
                <span class="stat-name">{{ config.name }}</span>
                <div class="stat-value">
                    <button @click="updateStat(stat, -1)" :disabled="character.stats[stat] <= 0">-</button>
                    <span class="stat-points">{{ character.stats[stat] }}</span>
                    <button @click="updateStat(stat, 1)" :disabled="character.stats[stat] >= config.max">+</button>
                </div>
            </div>
        </div>

        <div class="notes-area">
            <label for="notes">å¤‡æ³¨ / æŠ€èƒ½åˆ—è¡¨</label>
            <textarea id="notes" v-model="character.notes" placeholder="åœ¨æ­¤è®°å½•ä½ çš„ç¬”è®°æˆ–æŠ€èƒ½åˆ—è¡¨..."></textarea>
        </div>
    </div>

    <div v-if="currentTab === 'skillTree'" class="skill-tree-content">
        <h2>èŒä¸šæŠ€èƒ½æ ‘</h2>
        <select v-model="selectedClass">
            <option disabled value="">è¯·é€‰æ‹©ä¸€ä¸ªèŒä¸š</option>
            <option v-for="cls in availableClasses" :key="cls.id" :value="cls.id">
                {{ cls.name }}
            </option>
        </select>

        <div class="skill-tree-image-container">
            <img 
                v-if="selectedClass && skillTreeImages[selectedClass]" 
                :src="skillTreeImages[selectedClass]" 
                alt="Skill Tree Image"
            />
            <p v-else style="text-align: center; color: #666;">
                è¯·åœ¨ä¸Šæ–¹ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ä¸€ä¸ªèŒä¸šæ¥æŸ¥çœ‹å…¶æŠ€èƒ½æ ‘ã€‚
            </p>
        </div>
    </div>
</div>

<script>
    const { ref, reactive, computed, watch, onMounted } = Vue;

    // è§’è‰²å¡é»˜è®¤æ•°æ® (æ‚¨çš„åŸæ–‡ä»¶å†…å®¹)
    const defaultStats = {
        str: 0, // åŠ›é‡
        per: 0, // æ„ŸçŸ¥
        con: 0, // ä½“è´¨
        cha: 0, // é­…åŠ›
        int: 0, // æ™ºåŠ›
        dex: 0, // æ•æ·
    };

    // è§’è‰²å¡å±æ€§é…ç½® (æ‚¨çš„åŸæ–‡ä»¶å†…å®¹)
    const statConfigs = {
        str: { name: 'åŠ›é‡', max: 20 },
        per: { name: 'æ„ŸçŸ¥', max: 20 },
        con: { name: 'ä½“è´¨', max: 20 },
        cha: { name: 'é­…åŠ›', max: 20 },
        int: { name: 'æ™ºåŠ›', max: 20 },
        dex: { name: 'æ•æ·', max: 20 },
    };
    
    // æŠ€èƒ½æ ‘å›¾ç‰‡æ˜ å°„ (æ›´æ–°ä¸º .png æ ¼å¼)
    const skillTreeImages = {
        mage: 'æ³•å¸ˆæŠ€èƒ½.png',
        assassin: 'åˆºå®¢æŠ€èƒ½.png',
        druid: 'å¾·é²ä¼ŠæŠ€èƒ½.png',
        warrior: 'æˆ˜å£«æŠ€èƒ½.png',
        priest: 'ç‰§å¸ˆæŠ€èƒ½.png',
        hunter: 'çŒäººæŠ€èƒ½.png',
        warlock: 'æœ¯å£«æŠ€èƒ½.png',
        knight: 'éª‘å£«æŠ€èƒ½.png',
        bard: 'åŸæ¸¸è¯—äººæŠ€èƒ½.png',
        shaman: 'è¨æ»¡æŠ€èƒ½.png',
    };

    // èŒä¸šåˆ—è¡¨
    const availableClasses = [
        { id: 'mage', name: 'æ³•å¸ˆ' },
        { id: 'assassin', name: 'åˆºå®¢' },
        { id: 'druid', name: 'å¾·é²ä¼Š' },
        { id: 'warrior', name: 'æˆ˜å£«' },
        { id: 'priest', name: 'ç‰§å¸ˆ' },
        { id: 'hunter', name: 'çŒäºº' },
        { id: 'warlock', name: 'æœ¯å£«' },
        { id: 'knight', name: 'éª‘å£«' },
        { id: 'bard', name: 'åŸæ¸¸è¯—äºº' },
        { id: 'shaman', name: 'è¨æ»¡' },
    ];


    Vue.createApp({
        setup() {
            // æ–°å¢ Tab çŠ¶æ€
            const currentTab = ref('charCard');
            const selectedClass = ref('');

            // è§’è‰²å¡çŠ¶æ€ (æ‚¨çš„åŸæ–‡ä»¶å†…å®¹)
            const character = reactive({
                name: '',
                stats: { ...defaultStats },
                currentHp: 0, 
                gems: 0,
                notes: ''
            });
            const hpChangeValue = ref(1);

            const totalPoints = computed(() => {
                return Object.values(character.stats).reduce((sum, val) => sum + val, 0);
            });

            const derived = computed(() => {
                const con = character.stats.con;
                const int = character.stats.int;
                const dex = character.stats.dex;
                const str = character.stats.str;
                const per = character.stats.per;

                // æœ€å° MaxHp å¿…é¡»æ˜¯ 6
                const maxHp = 6 + (con * 6); 

                return {
                    attack: str, 
                    range: per, 
                    maxHp: maxHp, 
                    movement: 2 + Math.floor(dex / 2), 
                    action: 1 + int, 
                };
            });

            // è§’è‰²å¡æ–¹æ³•
            const updateStat = (stat, change) => {
                const current = character.stats[stat];
                const maxStat = statConfigs[stat].max;

                if (change > 0 && current < maxStat) {
                    character.stats[stat] += 1;
                } else if (change < 0 && current > 0) {
                    character.stats[stat] -= 1;
                }
            };

            const updateGem = (change) => {
                character.gems = Math.max(0, character.gems + change);
            };

            const updateCurrentHp = (change) => {
                const current = character.currentHp;
                // ç¡®ä¿å½“å‰ç”Ÿå‘½å€¼ä¸ä½äº 0
                const newHp = Math.min(derived.value.maxHp, Math.max(0, current + change));
                character.currentHp = newHp;
                hpChangeValue.value = 1; 
            };
            
            const resetCharacter = () => {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è§’è‰²æ•°æ®å—ï¼Ÿ')) {
                    character.name = '';
                    character.stats = { ...defaultStats };
                    character.currentHp = 6;
                    character.gems = 0;
                    character.notes = '';
                }
            };

            // åˆå§‹åŒ–åŠ è½½æ•°æ®
            onMounted(() => {
                const saved = localStorage.getItem('rpg-char-data-v4');
                const initialMaxHp = derived.value.maxHp;

                if (saved) {
                    const parsed = JSON.parse(saved);
                    character.name = parsed.name || '';
                    if (parsed.stats) character.stats = { ...defaultStats, ...parsed.stats };
                    character.gems = parsed.gems || 0;
                    character.notes = parsed.notes || '';
                    
                    const maxHpOnLoad = 6 + (character.stats.con * 6);
                    // ç¡®ä¿ currentHp åœ¨åŠ è½½æ—¶ä¸ä¼šè¶…è¿‡ Max HP
                    character.currentHp = Math.min(maxHpOnLoad, parsed.currentHp !== undefined ? parsed.currentHp : maxHpOnLoad);
                } else {
                    character.currentHp = initialMaxHp;
                }
            });

            // è‡ªåŠ¨ä¿å­˜
            watch(character, (newVal) => {
                localStorage.setItem('rpg-char-data-v4', JSON.stringify(newVal));
            }, { deep: true });
            
            // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹ï¼šç›‘å¬æœ€å¤§ç”Ÿå‘½å€¼å˜åŒ–
            watch(() => derived.value.maxHp, (newMaxHp, oldMaxHp) => {
                 const diff = newMaxHp - oldMaxHp;
                 
                 if (diff > 0) {
                     // æœ€å¤§ç”Ÿå‘½æå‡æ—¶ï¼ŒåŒæ­¥å¢åŠ å½“å‰ç”Ÿå‘½
                     character.currentHp = character.currentHp + diff;
                 } else if (diff < 0) {
                     // æœ€å¤§ç”Ÿå‘½å‡å°‘æ—¶ï¼ŒåŒæ­¥å‡å°‘å½“å‰ç”Ÿå‘½ï¼Œä½†æœ€ä½ä¸º 1
                     const newHp = character.currentHp + diff;
                     character.currentHp = Math.max(1, newHp);
                 }
            });


            return {
                currentTab,
                selectedClass,
                availableClasses,
                skillTreeImages,
                character,
                statConfigs,
                derived,
                totalPoints,
                hpChangeValue,
                updateStat,
                updateGem,
                updateCurrentHp,
                resetCharacter
            };
        }
    }).mount('#app');
</script>
